#!/usr/bin/env python

import argparse
import os
import pdbox
import sys


if __name__ != "__main__":
    print("pdbox script cannot be imorted; exiting")
    sys.exit(1)

# Add command-line arguments.
parser = pdbox.argparse.get_parser()

# Get the user's OAuth2 token.
# Look for an environment variable first, then check for a dedicated file.
# If we don't find one, then generate one.
if "PDBOX_TOKEN" in os.environ:
    token = os.environ["PDBOX_TOKEN"]
else:
    try:
        with open(pdbox.TOKEN_PATH) as f:
            token = f.read()
    except FileNotFoundError:
            try:
                token = pdbox.auth.auth_flow()
            except Exception as e:
                print("%s\nAuthentication failed; exiting" % e)
                sys.exit(1)

pdbox.auth.login(token)
args = parser.parse_args()
args.func(args)
